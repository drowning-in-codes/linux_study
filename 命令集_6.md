## Linux Shell及vi/vim使用

### vi/vim 简单使用

概念

vi是unix下的编辑程序,vim由vi改编增强版。

现在一般用的是vim

vim有多种模式

- 普通模式(Normal mode)

在普通模式中，用的编辑器命令，比如移动光标，删除文本等等。这也是 Vim 启动后的默认模式。这正好和许多新用户期待的操作方式相反（大多数编辑器默认模式为插入模式）。

这种设置与其他文本编辑器不太一样,但这样的话可以更快移动光标

在普通模式中，有很多方法可以进入插入模式。比较普通的方式是按 `a`（append／追加）键或者 `i`（insert／插入）键。

- 插入模式(Insert mode)

在这个模式中，大多数按键都会向文本缓冲中插入文本。大多数新用户希望文本编辑器编辑过程中一直保持这个模式。

> 在插入模式中，可以按 `ESC` 键回到普通模式。

- 可视模式(Visual mode)

> 这个模式与普通模式比较相似。但是移动命令会扩大高亮的文本区域。高亮区域可以是字符、行或者是一块文本。当执行一个非移动命令时，命令会被执行到这块高亮的区域上。Vim 的"文本对象"也能和移动命令一样用在这个模式中。

- 选择模式(Select mode)

> 这个模式和无模式编辑器的行为比较相似（Windows 标准文本控件的方式）。这个模式中，可以用鼠标或者光标键高亮选择文本，不过输入任何字符的话，Vim 会用这个字符替换选择的高亮文本块，并且自动进入插入模式。

- 命令行模式(Command line mode)

> 在命令行模式中可以输入会被解释成并执行的文本。例如执行命令（`:`键），搜索（`/`和`?`键）或者过滤命令（`!`键）。在命令执行之后，Vim 返回到命令行模式之前的模式，通常是普通模式。

- Ex 模式(Ex mode)

这和命令行模式比较相似，在使用 `:visual` 命令离开 Ex 模式前，可以一次执行多条命令。

### 模式切换

普通模式中按 `i`（插入）或 `a`（附加）键都可以进入插入模式，普通模式中按 `:` 进入命令行模式。命令行模式中输入 `wq` 回车后保存并退出 vim。

进入vim界面

vim practice_1.txt

进入命令行模式后还可以使用 e:file  打开其他文件

### 游标移动

| 按键  | 说明             |
| ----- | ---------------- |
| `h`   | 左               |
| `l`   | 右（小写 L）     |
| `j`   | 下               |
| `k`   | 上               |
| `w`   | 移动到下一个单词 |
| `b`   | 移动到上一个单词 |
| 0     | 光标到行首       |
| $     | 光标到行末       |
| numG  | 移动到num行      |
| G     | 移动到最后一行   |
| numj  | 向下移动num行    |
| numgg | 跳转至num行      |

进入插入模式

| 按键 | 说明             |
| ---- | ---------------- |
| `h`  | 左               |
| `l`  | 右（小写 L）     |
| `j`  | 下               |
| `k`  | 上               |
| `w`  | 移动到下一个单词 |
| `b`  | 移动到上一个单词 |

#### 命令行模式下保存文档

从普通模式输入 `:` 进入命令行模式，输入 `w` 回车，保存文档。输入 `:w <filename>` 可以将文档另存为其他文件名或存到其它路径下。



#### 命令行模式下退出 vim

从普通模式输入 `:` 进入命令行模式，输入 `wq` 回车，保存并退出编辑。

以下为其它几种退出方式：

| 命令               | 说明             |
| ------------------ | ---------------- |
| `:q!`              | 强制退出，不保存 |
| `:q`               | 退出             |
| `:wq!`             | 强制保存并退出   |
| `:w <文件路径>`    | 另存为           |
| `:saveas 文件路径` | 另存为           |
| `:x`               | 保存并退出       |
| `:wq`              | 保存并退出       |



#### 普通模式下退出 vim

普通模式下按下 `Shift+zz` 即可保存退出 vim。

#### 普通模式下删除 vim 文本信息

进入普通模式，使用下列命令可以进行文本快速删除：

| 命令      | 说明                       |
| --------- | -------------------------- |
| `x`       | 删除游标所在的字符         |
| `X`       | 删除游标所在前一个字符     |
| `Delete`  | 同 `x`                     |
| `dd`      | 删除整行                   |
| `dw`      | 删除一个单词（不适用中文） |
| `d$`或`D` | 删除至行尾                 |
| `d^`      | 删除至行首                 |
| `dG`      | 删除到文档结尾处           |
| `d1G`     | 删至文档首部               |
| 2dd       | 一次删除两行               |

### 行间跳转

| 命令                    | 说明                                                         |
| ----------------------- | ------------------------------------------------------------ |
| `nG`(n Shift+g) / `ngg` | 游标移动到第 n 行 **(如果默认没有显示行号，请先进入命令模式，输入 `:set nu` 以显示行号)** |
| `gg`                    | 游标移动到到第一行                                           |
| `G`(Shift+g)            | 到最后一行                                                   |

**`Ctrl+o` 快速回到上一次(跳转前)光标所在位置**

#### 行内跳转

普通模式下使用下列命令在行内按照单词为单位进行跳转：

| 命令      | 说明                                                       |
| --------- | ---------------------------------------------------------- |
| `w`       | 到下一个单词的开头                                         |
| `e`       | 到当前单词的结尾                                           |
| `b`       | 到前一个单词的开头                                         |
| `ge`      | 到前一个单词的结尾                                         |
| `0`或`^`  | 到行头                                                     |
| `$`       | 到行尾                                                     |
| `f<字母>` | 向后搜索<字母>并跳转到第一个匹配的位置(非常实用)           |
| `F<字母>` | 向前搜索<字母>并跳转到第一个匹配的位置                     |
| `t<字母>` | 向后搜索<字母>并跳转到第一个匹配位置之前的一个字母(不常用) |
| `T<字母>` | 向前搜索<字母>并跳转到第一个匹配位置之后的一个字母(不常用) |

#### 复制及粘贴文本

- 普通模式中使用 `y` 复制

- 普通模式中，`yy` 复制游标所在的整行（`3yy` 表示复制 3 行）

- 普通模式中，`y^` 复制至行首，或 `y0`。不含光标所在处字符。

- 普通模式中，`y$` 复制至行尾。含光标所在处字符。

- 普通模式中，`yw` 复制一个单词。

- 普通模式中，`y2w` 复制两个单词。

- 普通模式中，`yG` 复制至文本末。

- 普通模式中，`y1G` 复制至文本开头。

- 普通模式中使用 `p` 粘贴

- 普通模式中，`p`(小写)代表粘贴至光标后（下）

- 普通模式中，`P`(大写)代表粘贴至光标前（上）

  #### 粘贴

- 普通模式中使用 `p` 粘贴
- 普通模式中，`p`(小写)代表粘贴至光标后（下）
- 普通模式中，`P`(大写)代表粘贴至光标前（上）

#### 剪切

dd命令就是剪切

ddp可以实现交换行

### 字符串替换

| 命令             | 说明                                         |
| ---------------- | -------------------------------------------- |
| `r`+<待替换字母> | 将游标所在字母替换为指定字母                 |
| `R`              | 连续替换，直到按下 `Esc`                     |
| `cc`             | 替换整行，即删除游标所在行，并进入插入模式   |
| `cw`             | 替换一个单词，即删除一个单词，并进入插入模式 |
| `C`(大写)        | 替换游标以后至行末                           |
| `~`              | 反转游标所在字母大小写                       |
| `{n}u`           | 撤销一次或 n 次操作                          |
| `U`(大写)        | 撤销当前行的所有修改                         |
| `Ctrl+r`         | redo，即撤销 undo 的操作                     |

### 快速缩进

- 普通模式下输入 `>>` 整行将向右缩进
- 普通模式下输入 `<<` 整行向左回退
- 普通模式下输入 `:` 进入命令行模式下对 `shiftwidth` 值进行设置可以控制缩进和回退的字符数

:set shiftwidth=10

### 调整文本位置

:ce

:ri

:le 

分别将本行文本靠某个位置

### 快速查找

普通模式下输入 `/` 然后键入需要查找的字符串，按回车后就会进行查找。`?` 与`/`功能相同，只不过 `?` 是向上而 `/` 是向下查找。

进入查找之后，输入 `n` 和 `N` 可以继续查找。`n` 是查找下一个内容，`N` 查找上一个内容。

- 命令行模式下输入 `noh` 然后回车即可取消搜索

#### 使用 vim 编辑多个文件

编辑多个文件有两种形式，一种是在进入 vim 前使用的参数就是多个文件。另一种就是进入 vim 后再编辑其他的文件。 同时创建两个新文件并编辑

```bash
vim 1.txt 2.txt

默认进入1.txt文件的编辑界面命令行模式下输入 :n 编辑 2.txt 文件，可以加 ! 即 :n! 强制切换，之前一个文件的输入没有保存，仅仅切换到另一个文件命令行模式下输入 :N 编辑 1.txt 文件，可以加 ! 即 :N! 强制切换，之前文件内的输入没有保存，仅仅是切换到另一个文件
```

- 命令行模式下输入:e 3.txt 打开新文件 3.txt
- 命令行模式下输入`:e#` 回到前一个文件
- 命令行模式下输入`:ls`可以列出以前编辑过的文档
- 命令行模式下输入`:b 2.txt`（或者编号）可以直接进入文件 2.txt 编辑
- 命令行模式下输入`:bd 2.txt`（或者编号）可以删除以前编辑过的列表中的文件项目
- 命令行模式下输入`:e! 4.txt`，新打开文件 4.txt，放弃正在编辑的文件
- 命令行模式下输入`:f` 显示正在编辑的文件名
- 命令行模式下输入`:f new.txt`，改变正在编辑的文件名字为 new.txt

### 恢复文件

如果因为断电，终端意外关闭等原因造成文档没有保存，可以采用恢复方式。

vim 在编辑的时候会自动在当前文件目录下生成一个交换文件，一般以 `<filename>.swp` 的格式保存，如果有多个版本的交换文件，还可能是 `.swn`，`.swm` 等字母。注意这个交换文件的更新不是实时的，因为实时的更新会占用磁盘，影响系统其他正常进程的速度。

在命令行模式中输入 `!` 可以执行外部的 shell 命令。

- `:!ls` 用于显示当前目录的内容
- `:!rm FILENAME` 用于删除名为 FILENAME 的文件
- `:w FILENAME` 可将当前 VIM 中正在编辑的文件另存为 FILENAME 文件

## Shell变量 运算符 分支 循环 传递参数 函数使用